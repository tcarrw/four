<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Lavender Haze ¬∑ experience</title>
<meta name="description" content="A quiet, AirPlay-ready Lavender Haze experience: parallax sky, haze slider, timed notes, Cast Mode.">
<style>
  :root{
    --bg:#0a0811;
    --ink:#ece7f6; --ink-d:#bfb6d6;
    --lav1:#c8a6ff; --lav2:#a78bfa; --lav3:#d6a6ff; --mist:#ad9ad4;
    --panel:#100d18; --edge:rgba(255,255,255,.08); --ring:rgba(199,167,255,.45);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink); background:var(--bg);
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;
    -webkit-font-smoothing:antialiased;
  }

  /* HAZE SKY */
  .sky{position:fixed; inset:0; z-index:-2; overflow:hidden; pointer-events:none}
  .layer{
    position:absolute; inset:-10%;
    background:
      radial-gradient(1100px 700px at 70% -10%, rgba(200,166,255,.18), transparent 60%),
      radial-gradient(900px 600px at 0% 100%, rgba(167,139,250,.16), transparent 60%),
      radial-gradient(700px 500px at 110% 50%, rgba(214,166,255,.12), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0) 65%),
      var(--bg);
    filter: saturate(1.1) blur(.2px);
    transition: opacity .35s ease, transform .2s ease;
  }
  .stars{
    position:absolute; inset:0; opacity:.55; mix-blend-mode:screen;
    background:
      radial-gradient(1.8px 1.8px at 15% 30%, #fff, transparent 35%),
      radial-gradient(1.4px 1.4px at 40% 70%, #fff, transparent 35%),
      radial-gradient(1.1px 1.1px at 75% 20%, #fff, transparent 35%),
      radial-gradient(1.2px 1.2px at 90% 60%, #fff, transparent 35%),
      radial-gradient(1.4px 1.4px at 55% 45%, #fff, transparent 35%),
      transparent;
  }
  /* soft drifting mist particles */
  .mist{position:absolute; inset:-15%; background:conic-gradient(from 0deg, rgba(173,154,212,.06), transparent 60%); filter: blur(18px); opacity:.55; animation: drift 40s linear infinite}
  .mist.m2{animation-duration: 65s; opacity:.45}
  @keyframes drift{
    0%{transform:translate3d(0,0,0) rotate(0deg)}
    50%{transform:translate3d(-4%,2%,0) rotate(180deg)}
    100%{transform:translate3d(3%,-3%,0) rotate(360deg)}
  }

  .wrap{max-width:980px;margin:min(4vh,40px) auto;padding:16px}
  header{display:flex;align-items:center;gap:14px;flex-wrap:wrap;margin-bottom:14px}
  .glyph{font-size:22px}
  h1{margin:0;font-size:clamp(20px,3.6vw,28px)}
  .lede{margin:6px 0 10px;color:var(--ink-d)}

  .player{
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0)), var(--panel);
    border:1px solid var(--edge); border-radius:16px; padding:12px;
    box-shadow:0 10px 30px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.04) inset;
    position:relative; overflow:hidden;
  }

  .yt{width:100%; aspect-ratio:16/9; border-radius:12px; overflow:hidden; background:#000}
  .controls{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;padding:8px 6px 10px}
  .buttons{display:flex;align-items:center;gap:10px}
  button,.toggle{
    appearance:none;border:0;background:transparent;color:var(--ink);
    padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600;
  }
  button:hover,.toggle:hover{background:rgba(255,255,255,.06)}
  .bigplay{display:flex;align-items:center;gap:10px;padding:12px 16px;border:1px solid rgba(255,255,255,.1);border-radius:12px;background:rgba(255,255,255,.04)}
  .state{color:var(--ink-d);font-size:14px}
  .sliders{display:flex;align-items:center;gap:12px;color:var(--ink-d)}
  input[type="range"]{appearance:none;width:160px;height:4px;border-radius:999px;background:rgba(255,255,255,.15);outline:none}
  input[type="range"]::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:#fff;border:2px solid var(--lav2)}
  .queue{display:none} /* single-track experience */

  /* Timed notes */
  .note-fly{
    position:absolute; top:10%; left:110%;
    padding:8px 12px; border-radius:14px;
    background:rgba(24,18,40,.5); border:1px solid rgba(255,255,255,.18);
    color:var(--ink); font-size:14px; white-space:nowrap;
    backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
    animation: soar 9.5s linear forwards;
  }
  @keyframes soar{
    0%{ transform:translate(0, 0); opacity:0 }
    10%{ opacity:1 }
    55%{ transform:translate(-60vw, -10px) }
    100%{ transform:translate(-120vw, -24px); opacity:0 }
  }

  footer{margin:16px 0 8px;color:var(--ink-d);font-size:12px}

  /* Cast Mode: sky dominates */
  .cast header, .cast footer { display:none; }
  .cast .wrap{max-width:1200px; padding:8px; margin:0 auto}
  .cast .player{margin-top:10vh}
  .cast .yt{aspect-ratio:21/9}
  .cast .layer{opacity:1}
</style>
</head>
<body>
  <!-- Lavender Haze Sky -->
  <div class="sky" aria-hidden="true">
    <div class="layer" id="layer"></div>
    <div class="stars"></div>
    <div class="mist"></div>
    <div class="mist m2"></div>
  </div>

  <div class="wrap">
    <header>
      <div class="glyph">ü™ª</div>
      <div>
        <h1>Lavender Haze ¬∑ experience</h1>
        <p class="lede">Parallax lavender sky, haze slider, timed notes. Use the video‚Äôs AirPlay icon on iOS. Toggle <em>Cast Mode</em> for TV.</p>
      </div>
    </header>

    <section class="player" aria-label="player">
      <div id="yt" class="yt" role="region" aria-label="YouTube player" allow="autoplay; encrypted-media; picture-in-picture"></div>

      <div class="controls">
        <div class="buttons">
          <button id="play" class="bigplay" aria-label="Play/Pause">‚ñ∂Ô∏é Play</button>
          <button id="replay" aria-label="Replay">üîÅ Replay</button>
        </div>

        <div class="sliders">
          <label for="haze">Haze</label>
          <input id="haze" type="range" min="0" max="100" value="55" />
        </div>

        <div class="toggle" id="castToggle" title="Visually optimize for AirPlay/screen casting">üñ•Ô∏è Cast Mode: <strong>Off</strong></div>
        <div class="state" id="state">Ready</div>
      </div>
    </section>

    <footer>
      Video: Taylor Swift ‚Äì ‚ÄúLavender Haze‚Äù (official). Visuals are client-side only. No tracking, no audio overlays.
    </footer>
  </div>

<script>
/* ===== Track & notes (paraphrased, no lyrics) ===== */
const track = {
  id: "mkR_Qwix4KM", // Taylor Swift ‚Äì Lavender Haze (Official Music Video)
  notes: [
    { t: 14,  text: "soft focus ‚Üí deeper color" },
    { t: 36,  text: "blur becomes signal" },
    { t: 62,  text: "pulse in the periphery" },
    { t: 88,  text: "edges fade, feeling sharpens" },
    { t: 116, text: "lavender as a frequency" },
    { t: 144, text: "time soaks in, not by seconds" },
    { t: 176, text: "stay with the color shift" },
    { t: 204, text: "haze ‚â† confusion ‚Äî haze = mood" }
  ]
};

let player, tick=null, lastNoteIndex=-1, castMode=false;

/* ===== Parallax & Haze ===== */
(function parallax(){
  const layer = document.getElementById('layer');
  const apply = (x,y)=>{ layer.style.transform = `translate3d(${x}px, ${y}px, 0)`; };
  window.addEventListener('mousemove', e=>{
    const dx = (e.clientX / innerWidth - .5) * -20;
    const dy = (e.clientY / innerHeight - .5) * -12;
    apply(dx, dy);
  }, {passive:true});
  window.addEventListener('deviceorientation', e=>{
    if(!e || e.beta==null) return;
    const dx = (e.gamma || 0) * .6;
    const dy = (e.beta || 0) * .3;
    apply(dx, dy);
  }, {passive:true});

  // Haze density slider = opacity of mists + star dim
  const haze = document.getElementById('haze');
  const mists = document.querySelectorAll('.mist');
  const stars = document.querySelector('.stars');
  const updateHaze = ()=>{
    const v = +haze.value; // 0..100
    const o = 0.15 + (v/100)*0.6;
    mists.forEach((m,i)=>{ m.style.opacity = (i? o*0.9 : o); });
    stars.style.opacity = 0.65 - (v/100)*0.35; // denser haze, fewer stars
    layer.style.opacity = 0.85 + (v/100)*0.1;
  };
  haze.addEventListener('input', updateHaze, {passive:true});
  updateHaze();
})();

/* ===== UI ===== */
function status(s){ document.getElementById('state').textContent = s; }
function fly(text){
  const host = document.querySelector('.player');
  const el = document.createElement('div');
  el.className = 'note-fly';
  el.textContent = text;
  const y = 14 + Math.random()*60; // 14%..74%
  el.style.top = y + '%';
  host.appendChild(el);
  setTimeout(()=>{ if (el && el.parentNode) el.parentNode.removeChild(el); }, 10000);
}

/* ===== Player ===== */
function onYouTubeIframeAPIReady(){
  player = new YT.Player('yt', {
    width:'100%', height:'100%',
    videoId: track.id,
    playerVars: { autoplay:0, controls:1, rel:0, playsinline:1, modestbranding:1, iv_load_policy:3 },
    events: {
      onReady: ()=>{ status("Tap ‚ñ∂Ô∏é to begin"); },
      onStateChange: (e)=>{
        if(e.data===1){ status("Playing"); startTicker(); }
        if(e.data===2){ status("Paused"); }
        if(e.data===0){ status("Ended"); lastNoteIndex=-1; } // end
      }
    }
  });
}
window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

function startTicker(){
  stopTicker();
  tick = setInterval(()=>{
    if(!player || typeof player.getCurrentTime!=='function') return;
    const s = player.getPlayerState && player.getPlayerState();
    if(s!==1) return;
    const t = player.getCurrentTime ? player.getCurrentTime() : 0;
    for(let i=lastNoteIndex+1; i<track.notes.length; i++){
      if(t >= track.notes[i].t){ fly(track.notes[i].text); lastNoteIndex = i; }
      else break;
    }
  }, 300);
}
function stopTicker(){ if(tick){ clearInterval(tick); tick=null; } }

/* ===== Controls ===== */
document.getElementById('play').addEventListener('click', ()=>{
  const s = player.getPlayerState();
  if(s===1){ player.pauseVideo(); } else { player.playVideo(); }
});
document.getElementById('replay').addEventListener('click', ()=>{
  if(player && player.seekTo){ lastNoteIndex=-1; player.seekTo(0,true); player.playVideo(); }
});
document.getElementById('castToggle').addEventListener('click', function(){
  castMode = !castMode;
  document.body.classList.toggle('cast', castMode);
  this.innerHTML = 'üñ•Ô∏è Cast Mode: <strong>' + (castMode ? 'On' : 'Off') + '</strong>';
});
['fullscreenchange','webkitfullscreenchange','mozfullscreenchange','MSFullscreenChange'].forEach(ev=>{
  document.addEventListener(ev, ()=>{
    const fs = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
    if(!!fs !== castMode){
      castMode = !!fs;
      document.body.classList.toggle('cast', castMode);
      const t = document.getElementById('castToggle');
      t.innerHTML = 'üñ•Ô∏è Cast Mode: <strong>' + (castMode ? 'On' : 'Off') + '</strong>';
    }
  });
});

/* Load YouTube API */
(function(){
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var first = document.getElementsByTagName('script')[0];
  first.parentNode.insertBefore(tag, first);
})();
</script>
</body>
</html>
