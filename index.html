<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>four.plnt.earth — quiet count</title>
<meta name="theme-color" content="#0b0b0d">
<style>
  :root{
    --bg:#0b0b0d; --fg:#ececec; --dim:#b8b8c3; --line:#1a1a21;
    --muted:#9096a4; --good:#cde8c1; --bad:#f1c0c0; --hint:#d6c8a8;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:#0b0b0d;color:var(--fg);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
  a{color:inherit;text-decoration:none}
  header{max-width:1100px;margin:0 auto;padding:24px 24px 8px}
  h1{margin:0;font-size:28px;font-weight:700;letter-spacing:.3px}
  .sub{margin-top:6px;color:var(--dim);font-size:14px}
  .legend{max-width:1100px;margin:0 auto 8px;padding:0 24px;color:var(--muted);font-size:12px}

  .grid{max-width:1100px;margin:12px auto 28px;display:grid;grid-template-columns:repeat(2,1fr);gap:14px;padding:0 24px}
  .card{border:1px solid var(--line);background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));
    border-radius:14px;overflow:hidden}
  .card header{padding:14px 14px 10px}
  .title{font-weight:600}
  .meta{color:var(--muted);font-size:12px;margin-top:2px}
  .vid{position:relative;aspect-ratio:16/9;background:#000}
  .vid iframe{position:absolute;inset:0;width:100%;height:100%;border:0}

  .tags{display:flex;gap:8px;padding:8px 14px 0 14px;color:#cfcfd7;flex-wrap:wrap}
  .tag{border:1px solid var(--line);border-radius:999px;font-size:11px;padding:4px 8px;color:var(--dim)}

  .panel{display:flex;align-items:center;gap:10px;padding:12px 14px;border-top:1px solid var(--line)}
  .label{font-size:12px;color:var(--dim)}
  .counter{display:flex;align-items:center;gap:10px}
  .btn{appearance:none;border:1px solid var(--line);background:#121319;color:var(--fg);
    padding:8px 10px;border-radius:10px;font-size:13px}
  .btn:active{transform:translateY(1px)}
  .num{min-width:24px;text-align:center;font-variant-numeric:tabular-nums}
  .check{margin-left:auto}
  .result{font-size:12px;color:var(--dim)}
  .result.good{color:var(--good)}
  .result.bad{color:var(--bad)}

  details{max-width:1100px;margin:0 auto 18px;padding:0 24px}
  details summary{cursor:pointer;color:var(--dim);font-weight:600;list-style:none}
  details[open] summary{color:var(--hint)}
  details p{color:var(--muted);font-size:13px;line-height:1.45}

  footer{max-width:1100px;margin:10px auto 32px;padding:0 24px;color:var(--dim);font-size:12px;display:flex;align-items:center;gap:10px}

  /* dev */
  .devbar{display:none;max-width:1100px;margin:6px auto 0;padding:0 24px}
  .devbox{border:1px dashed var(--line);border-radius:10px;padding:10px 12px;color:var(--dim);font-size:12px;display:flex;align-items:center;gap:12px}
  .expected{display:none;margin-left:auto;color:var(--hint);font-size:12px}
  body.show-expected .expected{display:inline}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <header>
    <h1>four.plnt.earth</h1>
    <div class="sub">quiet count · listen, decide, repeat</div>
  </header>

  <div class="devbar" id="devbar">
    <div class="devbox">
      <strong>dev</strong>
      <label><input type="checkbox" id="toggleExpected"> show expected</label>
      <span id="devHint">calibrate: add <code>?calibrate=1</code> · reset button: <code>?reset=1</code></span>
    </div>
  </div>

  <p class="legend">count the <em>pronoun shifts</em> you hear (changes in who is speaking / being addressed: I ↔ you ↔ we ↔ they). set your number, then press <strong>check</strong>. nothing leaves your device.</p>

  <section class="grid" id="grid">
    <!-- exile -->
    <article class="card" data-song="exile">
      <header>
        <div class="title">exile (feat. Bon Iver)</div>
        <div class="meta">duet · winter camera</div>
      </header>
      <div class="vid">
        <iframe
          src="https://www.youtube.com/embed/osdoLjUNFnA?rel=0&modestbranding=1"
          title="exile (official lyric video)"
          allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen></iframe>
      </div>
      <div class="tags">
        <span class="tag">dialogue</span><span class="tag">call ↔ response</span><span class="tag">low register</span>
        <span class="expected" id="exp-exile"></span>
      </div>
      <div class="panel">
        <div class="label">pronoun shifts</div>
        <div class="counter">
          <button class="btn dec" data-key="exile">−</button>
          <div class="num" id="num-exile">0</div>
          <button class="btn inc" data-key="exile">+</button>
        </div>
        <button class="btn check" data-key="exile">check</button>
      </div>
      <div class="panel" aria-live="polite">
        <div class="result" id="res-exile"></div>
      </div>
    </article>

    <!-- betty -->
    <article class="card" data-song="betty">
      <header>
        <div class="title">betty</div>
        <div class="meta">teen vantage · porch steps</div>
      </header>
      <div class="vid">
        <iframe
          src="https://www.youtube.com/embed/6TAPqXkZW_I?rel=0&modestbranding=1"
          title="betty (official lyric video)"
          allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen></iframe>
      </div>
      <div class="tags">
        <span class="tag">single narrator</span><span class="tag">apology arc</span><span class="tag">harmonica</span>
        <span class="expected" id="exp-betty"></span>
      </div>
      <div class="panel">
        <div class="label">pronoun shifts</div>
        <div class="counter">
          <button class="btn dec" data-key="betty">−</button>
          <div class="num" id="num-betty">0</div>
          <button class="btn inc" data-key="betty">+</button>
        </div>
        <button class="btn check" data-key="betty">check</button>
      </div>
      <div class="panel" aria-live="polite">
        <div class="result" id="res-betty"></div>
      </div>
    </article>

    <!-- champagne problems -->
    <article class="card" data-song="champagne">
      <header>
        <div class="title">champagne problems</div>
        <div class="meta">foyer hush · detached empathy</div>
      </header>
      <div class="vid">
        <iframe
          src="https://www.youtube.com/embed/wMpqCRF7TKg?rel=0&modestbranding=1"
          title="champagne problems (official lyric video)"
          allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen></iframe>
      </div>
      <div class="tags">
        <span class="tag">observer</span><span class="tag">minor key</span><span class="tag">winter house</span>
        <span class="expected" id="exp-champagne"></span>
      </div>
      <div class="panel">
        <div class="label">pronoun shifts</div>
        <div class="counter">
          <button class="btn dec" data-key="champagne">−</button>
          <div class="num" id="num-champagne">0</div>
          <button class="btn inc" data-key="champagne">+</button>
        </div>
        <button class="btn check" data-key="champagne">check</button>
      </div>
      <div class="panel" aria-live="polite">
        <div class="result" id="res-champagne"></div>
      </div>
    </article>

    <!-- coney island -->
    <article class="card" data-song="coney">
      <header>
        <div class="title">coney island (with The National)</div>
        <div class="meta">cine memory · baritone syntax</div>
      </header>
      <div class="vid">
        <iframe
          src="https://www.youtube.com/embed/c_p_TBaHvos?rel=0&modestbranding=1"
          title="coney island (official lyric video)"
          allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen></iframe>
      </div>
      <div class="tags">
        <span class="tag">plural memory</span><span class="tag">elliptical</span><span class="tag">low tessitura</span>
        <span class="expected" id="exp-coney"></span>
      </div>
      <div class="panel">
        <div class="label">pronoun shifts</div>
        <div class="counter">
          <button class="btn dec" data-key="coney">−</button>
          <div class="num" id="num-coney">0</div>
          <button class="btn inc" data-key="coney">+</button>
        </div>
        <button class="btn check" data-key="coney">check</button>
      </div>
      <div class="panel" aria-live="polite">
        <div class="result" id="res-coney"></div>
      </div>
    </article>
  </section>

  <details>
    <summary>what counts as a “pronoun shift”?</summary>
    <p>A change in who is speaking or being addressed (I/you/we/they), including duet hand-offs and perspective flips. If it feels like the voice changes position, count it.</p>
  </details>

  <footer>
    <span>not all mirrors show the same light.</span>
  </footer>

<script>
  var TOLERANCE = 1;
  var MAX_COUNT = 12;
  var HINT_AFTER_FAILS = 2;

  var expected = {
    exile:      {min:4, max:6},
    betty:      {min:3, max:5},
    champagne:  {min:4, max:6},
    coney:      {min:4, max:6}
  };

  var hints = {
    exile: "count each hand-off or direct address change.",
    betty: "mostly one narrator; note the address flips.",
    champagne: "notice report vs direct speech moments.",
    coney: "shared lines + lens shifts count."
  };

  var params = new URLSearchParams(location.search);
  var CALIBRATE = params.get("calibrate")==="1";
  var DEV = params.get("dev")==="1";

  var counts   = JSON.parse(localStorage.getItem("four.counts")||"{}");
  var attempts = JSON.parse(localStorage.getItem("four.attempts")||"{}");

  ["exile","betty","champagne","coney"].forEach(function(k){
    if(typeof counts[k] !== "number"){ counts[k]=0; }
    if(typeof attempts[k] !== "number"){ attempts[k]=0; }
    var el = document.getElementById("num-"+k);
    if(el) el.textContent = counts[k];
  });

  function save(){
    localStorage.setItem("four.counts", JSON.stringify(counts));
    localStorage.setItem("four.attempts", JSON.stringify(attempts));
  }

  function setResult(key, ok, msg, hintMode){
    var el = document.getElementById("res-"+key);
    el.className = "result " + (ok?"good":(hintMode?"":"bad"));
    el.textContent = msg;
  }

  function withinRange(k, n){
    var e = expected[k];
    var min = (e.min!=null? e.min : e);
    var max = (e.max!=null? e.max : e);
    return n >= (min - TOLERANCE) && n <= (max + TOLERANCE);
  }

  document.querySelectorAll(".inc").forEach(function(b){
    b.addEventListener("click", function(){
      var k=this.getAttribute("data-key");
      counts[k]=(counts[k]||0)+1; if(counts[k]>MAX_COUNT) counts[k]=MAX_COUNT;
      document.getElementById("num-"+k).textContent = counts[k];
      save();
    });
  });
  document.querySelectorAll(".dec").forEach(function(b){
    b.addEventListener("click", function(){
      var k=this.getAttribute("data-key");
      counts[k]=(counts[k]||0)-1; if(counts[k]<0) counts[k]=0;
      document.getElementById("num-"+k).textContent = counts[k];
      save();
    });
  });

  document.querySelectorAll(".check").forEach(function(b){
    b.addEventListener("click", function(){
      var k=this.getAttribute("data-key");
      var n = counts[k]||0;

      if (CALIBRATE){
        expected[k] = {min:n, max:n};
        setResult(k, true, "✓ calibrated at "+n+" (±"+TOLERANCE+")", false);
        return;
      }

      var ok = withinRange(k, n);
      attempts[k] = (attempts[k]||0) + 1;
      save();

      if (ok){
        setResult(k, true, "✓ you heard "+n+" · in range", false);
        attempts[k] = 0; save();
      } else {
        var e = expected[k];
        var mm = (e.min!=null && e.max!=null) ? (e.min+"–"+e.max) : (e+"");
        var hint = (attempts[k] >= HINT_AFTER_FAILS && hints[k]) ? " · hint: "+hints[k] : "";
        var near = ""; 
        var anchor = (e.min!=null && e.max!=null) ? (n<e.min?e.min:e.max) : e;
        if (Math.abs(n - anchor)===1) near = " (very close)";
        setResult(k, false, "you heard "+n+" · expected ~"+mm+near+hint, attempts[k] >= HINT_AFTER_FAILS);
      }
    });
  });

  if (params.get("reset")==="1"){
    var f=document.querySelector("footer");
    if(f){
      var btn=document.createElement("button");
      btn.textContent="reset counts";
      btn.className="btn";
      btn.addEventListener("click", function(){
        localStorage.removeItem("four.counts");
        localStorage.removeItem("four.attempts");
        ["exile","betty","champagne","coney"].forEach(function(k){
          counts[k]=0; attempts[k]=0; document.getElementById("num-"+k).textContent="0";
          var r=document.getElementById("res-"+k); r.textContent=""; r.className="result";
        });
      });
      f.appendChild(btn);
    }
  }

  if (DEV){
    var devbar=document.getElementById("devbar");
    if(devbar) devbar.style.display="block";
    var t=document.getElementById("toggleExpected");
    document.body.classList.remove("show-expected");
    t.addEventListener("change", function(){
      if(this.checked){ document.body.classList.add("show-expected"); }
      else{ document.body.classList.remove("show-expected"); }
    });
    function setExpectedLabels(){
      ["exile","betty","champagne","coney"].forEach(function(k){
        var e=expected[k];
        var label = (e.min!=null && e.max!=null) ? (e.min+"–"+e.max) : (e+"");
        var span=document.getElementById("exp-"+k);
        if(span){ span.textContent = "expected ~"+label+(TOLERANCE?(" (±"+TOLERANCE+")"):""); }
      });
    }
    setExpectedLabels();
  }
</script>
</body>
</html>
