<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>four ¬∑ Opalite Edition</title>
<meta name="description" content="Opalite glass, parallax opal sky, AirPlay-ready. Four-song path with timed notes and Cast Mode.">
<style>
  :root{
    --bg:#081014;
    --ink:#eef5f8; --ink-d:#b6c6cf;
    --opal1:#cfe9ff; --opal2:#ffd6ec; --opal3:#d7ffe7; --opal4:#f7f1ff;
    --edge:rgba(255,255,255,.10); --ring:rgba(180,230,255,.55);
    --glass:rgba(255,255,255,.18); --glass-deep:rgba(255,255,255,.12);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink); background:var(--bg);
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;
    -webkit-font-smoothing:antialiased;
  }

  /* OPAL SKY */
  .sky{position:fixed; inset:0; z-index:-2; overflow:hidden; pointer-events:none}
  .opal{
    position:absolute; inset:-10%;
    background:
      radial-gradient(1200px 700px at 70% -10%, rgba(207,233,255,.18), transparent 60%),
      radial-gradient(900px 600px at 0% 100%, rgba(255,214,236,.16), transparent 60%),
      radial-gradient(800px 520px at 120% 40%, rgba(215,255,231,.14), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0) 65%),
      var(--bg);
    filter: saturate(1.08) blur(.2px);
    transition: opacity .35s ease, transform .2s ease;
  }
  .shimmer{
    position:absolute; inset:-20%;
    background: conic-gradient(from 0deg,
      rgba(255,255,255,.0) 0%,
      rgba(255,255,255,.12) 6%,
      rgba(255,255,255,.0) 12%,
      rgba(255,255,255,.1) 18%,
      rgba(255,255,255,.0) 24%,
      rgba(255,255,255,.08) 30%,
      rgba(255,255,255,.0) 36%,
      rgba(255,255,255,.10) 42%,
      rgba(255,255,255,.0) 48%,
      rgba(255,255,255,.08) 54%,
      rgba(255,255,255,.0) 60%,
      rgba(255,255,255,.10) 66%,
      rgba(255,255,255,.0) 100%);
    mix-blend-mode:screen;
    opacity:.28;
    animation: spin 28s linear infinite;
    filter: blur(18px);
  }
  @keyframes spin{to{transform:rotate(360deg)}}
  .pearls{
    position:absolute; inset:0; opacity:.5; mix-blend-mode:screen;
    background:
      radial-gradient(2px 2px at 15% 30%, #fff, transparent 35%),
      radial-gradient(1.5px 1.5px at 42% 70%, #fff, transparent 35%),
      radial-gradient(1.4px 1.4px at 75% 22%, #fff, transparent 35%),
      radial-gradient(1.8px 1.8px at 90% 64%, #fff, transparent 35%),
      radial-gradient(1.2px 1.2px at 58% 46%, #fff, transparent 35%),
      transparent;
  }

  .wrap{max-width:980px;margin:min(4vh,40px) auto;padding:16px}
  header{display:flex;align-items:center;gap:14px;flex-wrap:wrap;margin-bottom:14px}
  .gem{font-size:22px}
  h1{margin:0;font-size:clamp(20px,3.6vw,28px)}
  .lede{margin:6px 0 10px;color:var(--ink-d)}

  /* OPALITE GLASS PANEL */
  .panel{
    position:relative; overflow:hidden;
    border-radius:18px;
    background: linear-gradient(180deg, var(--glass), var(--glass-deep)),
                linear-gradient(120deg, rgba(207,233,255,.22), rgba(255,214,236,.16), rgba(215,255,231,.18), rgba(247,241,255,.14));
    border:1px solid var(--edge);
    box-shadow:
      0 24px 60px rgba(0,0,0,.45),
      0 0 0 1px rgba(255,255,255,.06) inset,
      0 1px 0 rgba(255,255,255,.35) inset;
    backdrop-filter: blur(16px) saturate(1.1);
    -webkit-backdrop-filter: blur(16px) saturate(1.1);
    padding:12px;
  }

  .yt{width:100%; aspect-ratio:16/9; border-radius:14px; overflow:hidden; background:#000}
  .controls{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;padding:8px 6px 10px}
  .buttons{display:flex;align-items:center;gap:10px}
  button,.toggle{
    appearance:none;border:0;background:transparent;color:var(--ink);
    padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600;
  }
  button:hover,.toggle:hover{background:rgba(255,255,255,.08)}
  .bigplay{display:flex;align-items:center;gap:10px;padding:12px 16px;border:1px solid rgba(255,255,255,.18);border-radius:12px;background:rgba(255,255,255,.10)}
  .state{color:var(--ink-d);font-size:14px}
  .queue{display:grid;gap:10px;margin-top:10px}
  .track{display:grid;grid-template-columns:56px 1fr;gap:10px;align-items:center;padding:10px;border-radius:12px;background:rgba(255,255,255,.08);border:1px solid var(--edge)}
  .badge{
    width:56px;height:56px;border-radius:12px;
    background: radial-gradient(120% 120% at 20% 10%, var(--opal1), transparent 60%),
                radial-gradient(120% 120% at 80% 90%, var(--opal2), transparent 60%),
                radial-gradient(140% 140% at -10% 80%, var(--opal3), transparent 60%),
                #e8f4ff;
    box-shadow: 0 0 0 2px rgba(0,0,0,.35) inset, 0 10px 18px rgba(0,0,0,.25);
    display:flex;align-items:center;justify-content:center;font-weight:800;color:#0a0f12;
  }
  .meta{display:flex;flex-direction:column;gap:2px}
  .title{font-weight:700}
  .note{color:var(--ink-d);font-size:14px}
  .track.active{outline:2px solid var(--ring);background:rgba(255,255,255,.12)}

  /* Timed notes (glide) */
  .note-fly{
    position:absolute; top:12%; left:110%;
    padding:8px 12px; border-radius:14px;
    background:rgba(255,255,255,.16);
    border:1px solid rgba(255,255,255,.30);
    color:var(--ink); font-size:14px; white-space:nowrap;
    backdrop-filter: blur(10px) saturate(1.15);
    -webkit-backdrop-filter: blur(10px) saturate(1.15);
    box-shadow: 0 6px 20px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.35) inset;
    animation: glide 10s linear forwards;
  }
  @keyframes glide{
    0%{ transform:translate(0, -6px); opacity:0 }
    10%{ opacity:1 }
    55%{ transform:translate(-60vw, 0) }
    100%{ transform:translate(-125vw, -14px); opacity:0 }
  }

  footer{margin:16px 0 8px;color:var(--ink-d);font-size:12px}

  /* Cast Mode */
  .cast header, .cast footer { display:none }
  .cast .wrap{max-width:1200px; padding:8px; margin:0 auto}
  .cast .panel{margin-top:8vh}
  .cast .yt{aspect-ratio:21/9}
  .cast .opal{opacity:1}
</style>
</head>
<body>
  <!-- Opalite Sky -->
  <div class="sky" aria-hidden="true">
    <div class="opal" id="opal"></div>
    <div class="shimmer"></div>
    <div class="pearls"></div>
  </div>

  <div class="wrap">
    <header>
      <div class="gem">ü™Ω</div>
      <div>
        <h1>four ¬∑ Opalite Edition</h1>
        <p class="lede">Opalite glass UI, parallax opal sky, native AirPlay via the video controls. Toggle <em>Cast Mode</em> for TV.</p>
      </div>
    </header>

    <section class="panel" aria-label="player">
      <div id="yt" class="yt" role="region" aria-label="YouTube player" allow="autoplay; encrypted-media; picture-in-picture"></div>

      <div class="controls">
        <div class="buttons">
          <button id="prev" aria-label="Previous">‚èÆ</button>
          <button id="play" class="bigplay" aria-label="Play/Pause">‚ñ∂Ô∏é Play</button>
          <button id="next" aria-label="Next">‚è≠</button>
        </div>
        <div class="toggle" id="loopToggle" role="switch" aria-checked="true">üîÅ Loop: <strong>On</strong></div>
        <div class="toggle" id="castToggle" title="Expand visuals for AirPlay/screen casting">üñ•Ô∏è Cast Mode: <strong>Off</strong></div>
        <div class="state" id="state">Ready</div>
      </div>

      <div class="queue" id="queue" aria-label="queue"></div>
    </section>

    <footer>
      Official videos from Taylor‚Äôs channel where available. Tap a track to jump. Loop replays the same track; turn off to advance.
    </footer>
  </div>

<script>
const tracks = [
  { id:"u9raS7-NisU", title:"Daylight ‚Äî Lover", hint:"red ‚Üí gold; light as evolution",
    notes:[{t:18,text:"red ‚Üí gold"},{t:64,text:"light evolves"},{t:125,text:"wavelength shift"}] },
  { id:"Odh9ddPUkEY", title:"Midnight Rain ‚Äî Midnights", hint:"sunshine / midnight; voices swap",
    notes:[{t:12,text:"sunshine ‚Üî midnight"},{t:48,text:"timelines split"},{t:102,text:"voices trade"}] },
  { id:"pEY-GPsru_E", title:"seven ‚Äî folklore", hint:"memory loop; child ‚Üî adult",
    notes:[{t:20,text:"child ‚Üî adult"},{t:54,text:"memory doesn‚Äôt age"},{t:96,text:"seven = circle"}] },
  { id:"F5TMU6916U8", title:"Long Live (Taylor‚Äôs Version) ‚Äî Speak Now (TV)", hint:"countdown in glitter; preserved time",
    notes:[{t:22,text:"saved like a spell"},{t:72,text:"glitter countdown"},{t:130,text:"time preserved"}] }
];

let player, current=0, looping=true, castMode=false, tick=null, lastNoteIndex=-1;

(function parallax(){
  const opal = document.getElementById('opal');
  const move = (x,y)=>{ opal.style.transform = `translate3d(${x}px, ${y}px, 0)`; };
  window.addEventListener('mousemove', e=>{
    const dx = (e.clientX / innerWidth - .5) * -18;
    const dy = (e.clientY / innerHeight - .5) * -10;
    move(dx, dy);
  }, {passive:true});
  window.addEventListener('deviceorientation', e=>{
    if(e && e.beta!=null){
      const dx = (e.gamma || 0) * .55;
      const dy = (e.beta || 0) * .28;
      move(dx, dy);
    }
  }, {passive:true});
})();

function renderQueue(){
  const q = document.getElementById('queue'); q.innerHTML="";
  tracks.forEach((t,i)=>{
    const b=document.createElement('button');
    b.className='track'+(i===current?' active':'');
    b.setAttribute('aria-label', t.title + '. ' + t.hint);
    b.onclick=()=>load(i,true);
    b.innerHTML=`
      <div class="badge">${i+1}</div>
      <div class="meta">
        <div class="title">${t.title}</div>
        <div class="note">${t.hint}</div>
      </div>`;
    q.appendChild(b);
  });
}

function status(s){ document.getElementById('state').textContent = s; }

function fly(text){
  const host = document.querySelector('.panel');
  const el = document.createElement('div');
  el.className = 'note-fly';
  el.textContent = text;
  const y = 12 + Math.random()*60;
  el.style.top = y + '%';
  host.appendChild(el);
  setTimeout(()=>{ if (el && el.parentNode) el.parentNode.removeChild(el); }, 10500);
}

function load(i, playAfter){
  current = (i + tracks.length) % tracks.length;
  lastNoteIndex = -1;
  renderQueue();
  const v = tracks[current].id;
  if (playAfter){ player.loadPlaylist({listType:'playlist', playlist:[v], index:0, startSeconds:0}); }
  else { player.cuePlaylist({listType:'playlist', playlist:[v], index:0, startSeconds:0}); }
  status("Loaded: " + tracks[current].title);
}

function next(){ load(current+1, true); }
function prev(){ load(current-1, true); }

function startTicker(){
  stopTicker();
  tick = setInterval(()=>{
    if(!player || typeof player.getCurrentTime!=='function') return;
    const s = player.getPlayerState && player.getPlayerState();
    if(s!==1) return;
    const t = player.getCurrentTime ? player.getCurrentTime() : 0;
    const notes = tracks[current].notes || [];
    for(let i=lastNoteIndex+1;i<notes.length;i++){
      if(t >= notes[i].t){ fly(notes[i].text); lastNoteIndex=i; }
      else break;
    }
  }, 300);
}
function stopTicker(){ if(tick){ clearInterval(tick); tick=null; } }

function onYouTubeIframeAPIReady(){
  player = new YT.Player('yt', {
    width:'100%', height:'100%',
    videoId: tracks[0].id,
    playerVars:{autoplay:0,controls:1,rel:0,playsinline:1,modestbranding:1,iv_load_policy:3},
    events:{
      onReady:()=>{ renderQueue(); status("Tap ‚ñ∂Ô∏é to begin"); },
      onStateChange:(e)=>{
        if(e.data===1){ status("Playing: " + tracks[current].title); startTicker(); }
        if(e.data===2){ status("Paused"); }
        if(e.data===0){
          if(looping){ player.loadPlaylist({listType:'playlist', playlist:[tracks[current].id], index:0, startSeconds:0}); lastNoteIndex=-1; }
          else { next(); }
        }
      }
    }
  });
}
window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

document.getElementById('play').addEventListener('click', ()=>{
  const s = player.getPlayerState();
  if(s===1){ player.pauseVideo(); } else { player.playVideo(); }
});
document.getElementById('next').addEventListener('click', next);
document.getElementById('prev').addEventListener('click', prev);
document.getElementById('loopToggle').addEventListener('click', function(){
  looping = !looping;
  this.innerHTML = 'üîÅ Loop: <strong>' + (looping ? 'On' : 'Off') + '</strong>';
});
document.getElementById('castToggle').addEventListener('click', function(){
  castMode = !castMode;
  document.body.classList.toggle('cast', castMode);
  this.innerHTML = 'üñ•Ô∏è Cast Mode: <strong>' + (castMode ? 'On' : 'Off') + '</strong>';
});
['fullscreenchange','webkitfullscreenchange','mozfullscreenchange','MSFullscreenChange'].forEach(ev=>{
  document.addEventListener(ev, ()=>{
    const fs = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
    const want = !!fs;
    if(want !== castMode){
      castMode = want;
      document.body.classList.toggle('cast', castMode);
      const t = document.getElementById('castToggle');
      t.innerHTML = 'üñ•Ô∏è Cast Mode: <strong>' + (castMode ? 'On' : 'Off') + '</strong>';
    }
  });
});

(function(){
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var first = document.getElementsByTagName('script')[0];
  first.parentNode.insertBefore(tag, first);
})();
</script>
</body>
</html>
