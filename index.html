<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Four ¬∑ Rabbit Hole</title>
<style>
:root{--bg:#07080c;--ink:#fff;--line:rgba(255,255,255,.12);--pane:rgba(255,255,255,.08);--veil:rgba(12,12,18,.9);--accent:#7fe3ff;--mint:#86ffd6}
html,body{height:100%}
body{margin:0;color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:radial-gradient(1000px 700px at 50% 20%,#0f1324,#07080c 70%)}
.nav{position:fixed;left:14px;top:14px;display:flex;gap:8px;z-index:60}
.nav a{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);backdrop-filter:blur(8px);padding:8px 10px;border-radius:999px;color:#fff;text-decoration:none}
#schoolBadge{display:none}
.topright a{position:fixed;right:14px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);backdrop-filter:blur(8px);padding:8px 10px;border-radius:999px;color:#fff;text-decoration:none;z-index:70}
#xBadge{top:14px}#igBadge{top:54px}
.tunnel{position:fixed;inset:0;pointer-events:none;opacity:.5;mix-blend-mode:screen;background:radial-gradient(ellipse at center,rgba(127,227,255,.08),transparent 60%),repeating-radial-gradient(circle at 50% 45%,rgba(134,255,214,.06),rgba(134,255,214,.06) 6px,transparent 6px,transparent 12px);animation:descend 9s linear infinite}
@keyframes descend{0%{transform:translateY(0)}100%{transform:translateY(40px)}}
.lock{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,.7));z-index:10}
.card{width:min(680px,92vw);background:var(--veil);border:1px solid var(--line);border-radius:16px;padding:18px;backdrop-filter:blur(10px);text-align:center}
.hint{opacity:.8}
.input{background:transparent;border:1px solid var(--line);border-radius:10px;outline:none;color:#fff;padding:8px 10px}
.btn{background:var(--pane);border:1px solid var(--line);border-radius:10px;padding:10px 14px;color:#fff;cursor:pointer}
.app{min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px}
.inner{width:min(1000px,96vw)}
.header{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin-bottom:12px}
.pill{background:var(--pane);border:1px solid var(--line);border-radius:999px;padding:6px 10px}
.rule{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.18),transparent);margin:10px 0}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.panel{background:rgba(12,12,18,.6);border:1px solid var(--line);border-radius:14px;padding:14px;text-align:left}
.title{font-weight:600;margin-bottom:6px}
.opts{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.opt{padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:var(--pane);cursor:pointer}
.opt.correct{border-color:rgba(134,255,214,.65);box-shadow:0 0 0 2px rgba(134,255,214,.25) inset}
.opt.wrong{opacity:.6}
.status{display:flex;gap:8px;flex-wrap:wrap}
.badge{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);background:var(--pane);border-radius:999px;padding:6px 10px}
.badge.ok{border-color:rgba(134,255,214,.5)}
.badge.need{border-color:rgba(255,204,112,.5)}
.cta{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.holderBadge{position:fixed;right:16px;bottom:16px;background:linear-gradient(180deg,#a6ffe6,#7fe3ff);color:#0c1a17;border:1px solid rgba(0,0,0,.25);border-radius:999px;padding:10px 14px;cursor:pointer;display:flex;gap:8px;align-items:center;z-index:20}
.panelHL{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:linear-gradient(180deg,transparent,rgba(0,0,0,.45));z-index:30}
.sheetHL{width:100%;max-width:680px;background:var(--veil);border:1px solid var(--line);border-radius:18px 18px 0 0;padding:16px 16px 22px}
.note{background:rgba(12,12,18,.6);border:1px solid var(--line);border-radius:14px;padding:14px;text-align:left}
.footer{position:fixed;left:14px;bottom:14px;font-size:.85rem;opacity:.65}
</style>
</head>
<body>
<div class="nav">
  <a href="https://center.plnt.earth" target="_blank">‚¨ÖÔ∏è Center</a>
  <a href="https://school.plnt.earth" target="_blank" id="schoolBadge">üéì School</a>
</div>
<div class="topright">
  <a id="xBadge" href="https://x.com/illuminatnotes" target="_blank">‚úñÔ∏è @illuminatnotes</a>
  <a id="igBadge" href="https://instagram.com/harry_spookies" target="_blank">üü£ @harry_spookies</a>
</div>
<div class="tunnel"></div>

<!-- Locked: requires Marina link (token) -->
<div id="lock" class="lock">
  <div class="card">
    <h2>Rabbit Hole</h2>
    <p class="hint">This door opens from the mirror. Ask Marina for the link.</p>
  </div>
</div>

<!-- App -->
<div id="app" class="app" style="display:none">
  <div class="inner">
    <div class="header">
      <div class="pill">Architect: #Alice</div>
      <div class="pill" id="srcTag"></div>
    </div>

    <div class="note">
      <h3 style="margin:0 0 6px 0">Boundary Storyteller</h3>
      <div class="rule"></div>
      <p class="hint" style="margin:6px 0 0 0">
        Alice, you and Taylor write the line between wonder and order.
        Every key you hand out is a story about how to cross it.
      </p>
    </div>

    <div class="rule"></div>

    <div class="grid">
      <!-- Taylor Quiz -->
      <div class="panel">
        <div class="title">Taylor Quiz</div>
        <div class="opts" id="quiz">
          <div data-q="1" class="opt">what opens a door without breaking it? ‚Äî permission</div>
          <div data-q="2" class="opt">what returns warmth from a mirror? ‚Äî set warm</div>
          <div data-q="3" class="opt">how do we move through time? ‚Äî don‚Äôt spend what you don‚Äôt have</div>
        </div>
        <div id="quizMsg" class="hint" style="margin-top:8px">tap each line when you know it</div>
      </div>

      <!-- Videos -->
      <div class="panel">
        <div class="title">Videos</div>
        <div id="vWrap" style="display:grid;gap:10px">
          <div style="position:relative;aspect-ratio:16/9;background:#000;border:1px solid var(--line);border-radius:12px;overflow:hidden">
            <iframe id="vid1" allow="autoplay; encrypted-media" allowfullscreen style="border:0;width:100%;height:100%;display:none"></iframe>
            <div id="v1empty" class="hint" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center">holder can set video 1</div>
          </div>
          <div style="position:relative;aspect-ratio:16/9;background:#000;border:1px solid var(--line);border-radius:12px;overflow:hidden">
            <iframe id="vid2" allow="autoplay; encrypted-media" allowfullscreen style="border:0;width:100%;height:100%;display:none"></iframe>
            <div id="v2empty" class="hint" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center">holder can set video 2</div>
          </div>
        </div>
      </div>
    </div>

    <div class="rule"></div>

    <!-- Keys needed -->
    <div class="panel">
      <div class="title">Keys Checklist</div>
      <div class="status" id="keyStatus"></div>
      <div class="cta">
        <button id="needGarlic" class="btn">get the castle key</button>
        <button id="needMirror" class="btn">open the mirror</button>
        <button id="toSchool" class="btn" style="display:none;background:linear-gradient(180deg,#a6ffe6,#7fe3ff);color:#0c1a17;border:1px solid rgba(0,0,0,.25)">proceed to school</button>
      </div>
      <div class="hint" style="margin-top:6px">you‚Äôll need both before the door to school opens.</div>
    </div>

    <div class="cta" style="justify-content:center;margin-top:8px">
      <a class="btn" href="https://garlic.plnt.earth" style="text-decoration:none;opacity:.9">‚Üê seek the field of clarity</a>
    </div>
  </div>
</div>

<!-- Holder Tools -->
<div class="holderBadge" id="holderBadge">üóùÔ∏è holder</div>
<div class="panelHL" id="panelHL">
  <div class="sheetHL">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:600">Holder tools</div>
      <button id="closeHL" class="btn">close</button>
    </div>
    <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
      <input id="holderWho" class="input" placeholder="type: alice" style="flex:1">
      <button id="holderGo" class="btn">enter</button>
    </div>
    <div id="holderOps" style="display:none;margin-top:10px">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <input id="v1set" class="input" placeholder="youtube id 1">
        <input id="v2set" class="input" placeholder="youtube id 2">
        <button id="saveV" class="btn">save videos</button>
      </div>
      <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
        <button id="giftMH" class="btn">copy ‚Äúgift a mirror‚Äù link</button>
        <span id="giftMsg" class="hint"></span>
      </div>
      <div class="hint" style="margin-top:6px">share this link with anyone curious; it opens MirrorHoney (token). next key is learned inside.</div>
    </div>
  </div>
</div>

<div class="footer">‚ÄúIf you knew Time as well as I do, you wouldn‚Äôt talk about wasting it.‚Äù</div>

<script>
function norm(s){return String(s||"").toLowerCase().trim()}
function fnv1a(t){var h=0x811c9dc5;for(var i=0;i<t.length;i++){h^=t.charCodeAt(i);h=(h*0x01000193)>>>0}return h>>>0}
function genCode(){return Math.random().toString(36).slice(2,6)+"-"+Math.random().toString(36).slice(2,6)+"-"+Math.random().toString(36).slice(2,6)}
</script>

<!-- Arrival: require Marina token; read tokens from query (g,m) -->
<script>
(function(){
  function pick(s,pat){var m=String(s||"").match(pat);return m?decodeURIComponent(m[1]):""}
  var src=pick(location.search,/[\?&]s=([^&]+)/),
      g=pick(location.search,/[\?&]g=([^&]+)/),
      m=pick(location.search,/[\?&]m=([^&]+)/),
      k=pick(location.hash,/[#?&]k=([^&]+)/);
  if(src) localStorage.setItem("four.src",JSON.stringify(src));
  if(g) localStorage.setItem("four.token.g",JSON.stringify(g));
  if(m) localStorage.setItem("four.token.m",JSON.stringify(m));
  if(k){ localStorage.setItem("four.unlock","true") }
  history.replaceState({},document.title,location.pathname);
})();
</script>

<script>
const lock=document.getElementById("lock"),app=document.getElementById("app"),srcTag=document.getElementById("srcTag")
const keyStatus=document.getElementById("keyStatus"),needGarlic=document.getElementById("needGarlic"),needMirror=document.getElementById("needMirror"),toSchool=document.getElementById("toSchool")
const vid1=document.getElementById("vid1"),vid2=document.getElementById("vid2"),v1empty=document.getElementById("v1empty"),v2empty=document.getElementById("v2empty")
const holderBadge=document.getElementById("holderBadge"),panelHL=document.getElementById("panelHL"),closeHL=document.getElementById("closeHL")
const holderWho=document.getElementById("holderWho"),holderGo=document.getElementById("holderGo"),holderOps=document.getElementById("holderOps"),giftMH=document.getElementById("giftMH"),giftMsg=document.getElementById("giftMsg")
const v1set=document.getElementById("v1set"),v2set=document.getElementById("v2set"),saveV=document.getElementById("saveV")
const dots=[document.createElement("div"),document.createElement("div"),document.createElement("div")]
let done={1:false,2:false,3:false}

function jget(k,def){try{return JSON.parse(localStorage.getItem(k)||def)}catch(e){return JSON.parse(def)}}
function jset(k,v){localStorage.setItem(k,JSON.stringify(v))}
function show(){lock.style.display="none";app.style.display="flex";srcTag.textContent=jget("four.src","\"mh.four\"")}
function haveG(){return !!jget("four.token.g","\"\"")}
function haveM(){return !!jget("four.token.m","\"\"")}
function renderStatus(){
  keyStatus.innerHTML=""
  const g=document.createElement("div");g.className="badge "+(haveG()?"ok":"need");g.textContent="garlic ¬∑ castle key "+(haveG()?"‚úî":"‚Ä¢")
  const m=document.createElement("div");m.className="badge "+(haveM()?"ok":"need");m.textContent="mirror ¬∑ door key "+(haveM()?"‚úî":"‚Ä¢")
  keyStatus.appendChild(g);keyStatus.appendChild(m)
  needGarlic.style.display = haveG() ? "none" : "inline-flex"
  needMirror.style.display = haveM() ? "none" : "inline-flex"
  toSchool.style.display = (haveG() && haveM() && done[1] && done[2] && done[3]) ? "inline-flex" : "none"
}
function yt(id){return "https://www.youtube.com/embed/"+id+"?rel=0&modestbranding=1&playsinline=1"}
function loadVideos(){
  const a=jget("four.taylor.v1","\"\""),b=jget("four.taylor.v2","\"\"")
  if(a){vid1.src=yt(a);vid1.style.display="block";v1empty.style.display="none"}
  if(b){vid2.src=yt(b);vid2.style.display="block";v2empty.style.display="none"}
}
function markQuiz(n){
  done[n]=true
  const msg=document.getElementById("quizMsg")
  const finished = done[1]&&done[2]&&done[3]
  msg.textContent = finished ? "quiz complete" : "keep going"
  renderStatus()
}
document.getElementById("quiz").addEventListener("click",function(e){
  const t=e.target;if(!t.classList.contains("opt"))return
  const q=t.getAttribute("data-q")
  if(q==="1" && t.textContent.includes("permission")){t.classList.add("correct");markQuiz(1)}
  else if(q==="2" && t.textContent.includes("set warm")){t.classList.add("correct");markQuiz(2)}
  else if(q==="3" && t.textContent.includes("don‚Äôt spend")){t.classList.add("correct");markQuiz(3)}
  else{t.classList.add("wrong")}
})
needGarlic.onclick=function(){location.href="https://garlic.plnt.earth/?s=four.need.g"}
needMirror.onclick=function(){location.href="https://mirrorhoney.plnt.earth/?s=four.need.m"}
toSchool.onclick=function(){
  const g=jget("four.token.g","\"g\""), m=jget("four.token.m","\"m\""), f=genCode()
  location.href="https://school.plnt.earth/?s=four.rabbit&g="+encodeURIComponent(g)+"&m="+encodeURIComponent(m)+"&f="+encodeURIComponent(f)+"#k="+encodeURIComponent(genCode())
}
holderBadge.onclick=function(){panelHL.style.display="flex"}
closeHL.onclick=function(){panelHL.style.display="none"}
panelHL.addEventListener("click",function(e){if(e.target===panelHL)panelHL.style.display="none"})
holderGo.onclick=function(){if(norm(holderWho.value)==="alice"){holderOps.style.display="block";holderWho.value=""}}
saveV.onclick=function(){const a=norm(v1set.value),b=norm(v2set.value);if(a)jset("four.taylor.v1",a);if(b)jset("four.taylor.v2",b);loadVideos()}
giftMH.onclick=function(){var u="https://mirrorhoney.plnt.earth/",q="?s="+encodeURIComponent("four.gift"),h="#k="+encodeURIComponent(genCode());navigator.clipboard.writeText(u+q+h);giftMsg.textContent="copied"}
window.addEventListener("load",function(){
  if(localStorage.getItem("four.unlock")){show();loadVideos();renderStatus()}
})
</script>
</body>
</html>
