<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>four ¬∑ Opalite ‚Äî Lyric/Visual + TV/AirPlay</title>
<meta name="description" content="Opalite glass. Lyric/Visual toggle. Timed notes. Loop. TV/AirPlay layout mode.">
<style>
  :root{
    --bg:#081014; --ink:#eef5f8; --ink-d:#b6c6cf;
    --opal1:#cfe9ff; --opal2:#ffd6ec; --opal3:#d7ffe7; --opal4:#f7f1ff;
    --edge:rgba(255,255,255,.10); --ring:rgba(180,230,255,.55);
    --glass:rgba(255,255,255,.18); --glass-deep:rgba(255,255,255,.12);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;color:var(--ink);background:var(--bg);
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;
    -webkit-font-smoothing:antialiased}
  /* Opal sky */
  .sky{position:fixed;inset:0;z-index:-2;overflow:hidden;pointer-events:none}
  .opal{position:absolute;inset:-10%;
    background:
      radial-gradient(1200px 700px at 70% -10%, rgba(207,233,255,.18), transparent 60%),
      radial-gradient(900px 600px at 0% 100%, rgba(255,214,236,.16), transparent 60%),
      radial-gradient(800px 520px at 120% 40%, rgba(215,255,231,.14), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0) 65%),
      var(--bg);
    filter:saturate(1.08) blur(.2px)}
  .wrap{max-width:980px;margin:min(4vh,40px) auto;padding:16px}
  header{display:flex;align-items:center;gap:14px;flex-wrap:wrap;margin-bottom:14px}
  .gem{font-size:22px}
  h1{margin:0;font-size:clamp(20px,3.6vw,28px)}
  .lede{margin:6px 0 10px;color:var(--ink-d)}
  .panel{position:relative;overflow:hidden;border-radius:18px;
    background:linear-gradient(180deg,var(--glass),var(--glass-deep)),
              linear-gradient(120deg, rgba(207,233,255,.22), rgba(255,214,236,.16), rgba(215,255,231,.18), rgba(247,241,255,.14));
    border:1px solid var(--edge);
    box-shadow:0 24px 60px rgba(0,0,0,.45),0 0 0 1px rgba(255,255,255,.06) inset,0 1px 0 rgba(255,255,255,.35) inset;
    backdrop-filter:blur(16px) saturate(1.1);-webkit-backdrop-filter:blur(16px) saturate(1.1);padding:12px}
  .yt{width:100%;aspect-ratio:16/9;border-radius:14px;overflow:hidden;background:#000}
  .controls{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;padding:8px 6px 10px}
  .buttons{display:flex;align-items:center;gap:10px}
  button,.toggle{appearance:none;border:0;background:transparent;color:var(--ink);padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600}
  button:hover,.toggle:hover{background:rgba(255,255,255,.08)}
  .bigplay{display:flex;align-items:center;gap:10px;padding:12px 16px;border:1px solid rgba(255,255,255,.18);border-radius:12px;background:rgba(255,255,255,.10)}
  .state{color:var(--ink-d);font-size:14px}
  .mode{display:flex;align-items:center;gap:6px}
  .seg{display:inline-flex;border:1px solid rgba(255,255,255,.18);border-radius:12px;overflow:hidden}
  .seg button{padding:8px 12px}
  .seg button.active{background:rgba(255,255,255,.12)}
  .queue{display:grid;gap:10px;margin-top:10px}
  .track{display:grid;grid-template-columns:56px 1fr;gap:10px;align-items:center;padding:10px;border-radius:12px;background:rgba(255,255,255,.08);border:1px solid var(--edge)}
  .badge{width:56px;height:56px;border-radius:12px;background:
      radial-gradient(120% 120% at 20% 10%, var(--opal1), transparent 60%),
      radial-gradient(120% 120% at 80% 90%, var(--opal2), transparent 60%),
      radial-gradient(140% 140% at -10% 80%, var(--opal3), transparent 60%), #e8f4ff;
    box-shadow:0 0 0 2px rgba(0,0,0,.35) inset,0 10px 18px rgba(0,0,0,.25);
    display:flex;align-items:center;justify-content:center;font-weight:800;color:#0a0f12}
  .meta{display:flex;flex-direction:column;gap:2px}
  .title{font-weight:700}
  .note{color:var(--ink-d);font-size:14px}
  .track.active{outline:2px solid var(--ring);background:rgba(255,255,255,.12)}
  /* notes */
  .note-fly{position:absolute;top:12%;left:110%;padding:8px 12px;border-radius:14px;
    background:rgba(255,255,255,.16);border:1px solid rgba(255,255,255,.30);color:var(--ink);
    font-size:14px;white-space:nowrap;backdrop-filter:blur(10px) saturate(1.15);-webkit-backdrop-filter:blur(10px) saturate(1.15);
    box-shadow:0 6px 20px rgba(0,0,0,.25),0 1px 0 rgba(255,255,255,.35) inset;animation:glide 10s linear forwards}
  @keyframes glide{0%{transform:translate(0,-6px);opacity:0}10%{opacity:1}55%{transform:translate(-60vw,0)}100%{transform:translate(-125vw,-14px);opacity:0}}
  /* TV/AirPlay layout mode (visual only; AirPlay button is in the iOS player UI) */
  .tv header,.tv footer{display:none}
  .tv .wrap{max-width:1200px;padding:8px;margin:0 auto}
  .tv .panel{margin-top:8vh}
  .tv .yt{aspect-ratio:21/9}
</style>
</head>
<body>
  <div class="sky" aria-hidden="true">
    <div class="opal"></div>
  </div>

  <div class="wrap">
    <header>
      <div class="gem">ü™Ω</div>
      <div>
        <h1>four ¬∑ Opalite</h1>
        <p class="lede">Lyric/Visual toggle, timed notes, loop. Use the iOS video control to AirPlay; toggle <em>TV mode</em> for casting layout.</p>
      </div>
    </header>

    <section class="panel" aria-label="player">
      <div id="yt" class="yt" role="region" aria-label="YouTube player"
           allow="autoplay; encrypted-media; picture-in-picture; fullscreen; accelerometer; gyroscope; clipboard-write"></div>

      <div class="controls">
        <div class="buttons">
          <button id="prev" aria-label="Previous">‚èÆ</button>
          <button id="play" class="bigplay" aria-label="Play/Pause">‚ñ∂Ô∏é Play</button>
          <button id="next" aria-label="Next">‚è≠</button>
        </div>

        <div class="mode" aria-label="video mode">
          üé¨ Mode:
          <div class="seg" role="tablist" aria-label="Lyric or Visual">
            <button id="btnLyric" role="tab" aria-selected="true" class="active">Lyric</button>
            <button id="btnVisual" role="tab" aria-selected="false">Visual</button>
          </div>
        </div>

        <button class="toggle" id="loopToggle" role="switch" aria-checked="true">üîÅ Loop: <strong>On</strong></button>
        <button class="toggle" id="tvToggle" title="Optimize layout for AirPlay / TV">üì∫ TV Mode: <strong>Off</strong></button>

        <span class="state" id="state">Ready</span>
      </div>

      <div class="queue" id="queue" aria-label="queue"></div>
    </section>

    <footer>
      Official uploads only. Tap the AirPlay icon in the video controls on iOS to cast. TV Mode only changes layout.
    </footer>
  </div>

<script>
/* IDs per mode (official only) */
const IDs_LYRIC  = ["u9raS7-NisU","Odh9ddPUkEY","pEY-GPsru_E","F5TMU6916U8"]; // lyric/audio
const IDs_VISUAL = ["mweYZKxvWUQ","Odh9ddPUkEY","pEY-GPsru_E","F5TMU6916U8"]; // Daylight film; others fallback

/* Titles/Hints (shared) */
const TITLES = [
  "Daylight ‚Äî Lover",
  "Midnight Rain ‚Äî Midnights",
  "seven ‚Äî folklore",
  "Long Live (Taylor‚Äôs Version) ‚Äî Speak Now (TV)"
];
const HINTS = [
  "red ‚Üí gold; light as evolution",
  "sunshine / midnight; voices swap",
  "memory loop; child ‚Üî adult",
  "countdown in glitter; preserved time"
];

/* Timed notes (shared) */
const NOTES = [
  [{t:10,text:"red ‚Üí gold"},{t:28,text:"light evolves"},{t:64,text:"wavelength shift"},{t:95,text:"edges soften"},{t:125,text:"origin becomes glow"}],
  [{t:7,text:"two timelines"},{t:12,text:"sunshine ‚Üî midnight"},{t:33,text:"weather in the vocal"},{t:48,text:"split, then rejoin"},{t:102,text:"voices trade places"}],
  [{t:14,text:"child ‚Üî adult"},{t:27,text:"memory doesn‚Äôt age"},{t:54,text:"seven = circle"},{t:81,text:"time feels like color"},{t:96,text:"home as a frequency"}],
  [{t:12,text:"saved like a spell"},{t:22,text:"glitter countdown"},{t:48,text:"we keep what we sing"},{t:72,text:"time preserved"},{t:130,text:"circle closes"}]
];

let mode = (localStorage.getItem('four.mode') || 'lyric'); // 'lyric' | 'visual'
let player, current=0, looping=true, ticker=null, lastNote=-1;

const getIDs = () => (mode==='visual' ? IDs_VISUAL : IDs_LYRIC);

function renderModeUI(){
  const L = document.getElementById('btnLyric');
  const V = document.getElementById('btnVisual');
  if(mode==='lyric'){ L.classList.add('active'); L.setAttribute('aria-selected','true'); V.classList.remove('active'); V.setAttribute('aria-selected','false'); }
  else{ V.classList.add('active'); V.setAttribute('aria-selected','true'); L.classList.remove('active'); L.setAttribute('aria-selected','false'); }
}
function renderQueue(){
  const q = document.getElementById('queue'); q.innerHTML='';
  TITLES.forEach((title,i)=>{
    const b=document.createElement('button');
    b.className='track'+(i===current?' active':'');
    b.onclick=()=>load(i,true);
    b.innerHTML=`<div class="badge">${i+1}</div>
      <div class="meta"><div class="title">${title}</div><div class="note">${HINTS[i]} <span style="opacity:.7">(${mode})</span></div></div>`;
    q.appendChild(b);
  });
}
function status(t){ document.getElementById('state').textContent=t; }
function fly(text){
  const host=document.querySelector('.panel');
  const el=document.createElement('div');
  el.className='note-fly';
  const lane = Math.floor(Math.random()*7);
  const top = 12 + lane*((74-12)/7);
  el.style.top = top + '%';
  el.textContent=text;
  host.appendChild(el);
  setTimeout(()=>{ el.remove(); }, 10000);
}

/* Player control */
function load(i, play){
  current = (i + TITLES.length) % TITLES.length;
  lastNote = -1;
  renderQueue();
  const id = getIDs()[current];
  // Swap video quickly and reliably
  if(play){ player.loadVideoById({videoId:id, startSeconds:0}); }
  else    { player.cueVideoById({videoId:id, startSeconds:0}); }
  status(`Loaded: ${TITLES[current]} ‚Ä¢ ${mode}`);
}
function next(){ load(current+1, true); }
function prev(){ load(current-1, true); }

function startTicker(){
  stopTicker();
  ticker = setInterval(()=>{
    if(!player || typeof player.getCurrentTime!=='function') return;
    if(player.getPlayerState()!==1) return;
    const t = player.getCurrentTime();
    const notes = NOTES[current] || [];
    for(let i=lastNote+1;i<notes.length;i++){
      if(t >= notes[i].t){ fly(notes[i].text); lastNote=i; } else break;
    }
  }, 250);
}
function stopTicker(){ if(ticker){ clearInterval(ticker); ticker=null; } }

function onYouTubeIframeAPIReady(){
  player = new YT.Player('yt',{
    width:'100%', height:'100%',
    videoId:getIDs()[0],
    playerVars:{autoplay:0,controls:1,rel:0,playsinline:1,modestbranding:1,iv_load_policy:3},
    events:{
      onReady:()=>{ renderModeUI(); renderQueue(); status(`Tap ‚ñ∂Ô∏é to begin (${mode})`); },
      onStateChange:(e)=>{
        if(e.data===1){ status(`Playing: ${TITLES[current]}`); startTicker(); }
        if(e.data===2){ status('Paused'); }
        if(e.data===0){ // ended
          if(looping){ player.seekTo(0,true); player.playVideo(); lastNote=-1; }
          else { next(); }
        }
      }
    }
  });
}
window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

/* UI bindings */
document.getElementById('play').onclick = ()=>{ const s=player.getPlayerState(); s===1?player.pauseVideo():player.playVideo(); };
document.getElementById('next').onclick = next;
document.getElementById('prev').onclick = prev;
document.getElementById('loopToggle').onclick = function(){
  looping = !looping; this.innerHTML='üîÅ Loop: <strong>'+(looping?'On':'Off')+'</strong>';
};
document.getElementById('tvToggle').onclick = function(){
  const on = document.body.classList.toggle('tv');
  this.innerHTML='üì∫ TV Mode: <strong>'+(on?'On':'Off')+'</strong>';
};
document.getElementById('btnLyric').onclick = ()=>{
  if(mode!=='lyric'){ mode='lyric'; localStorage.setItem('four.mode',mode); renderModeUI(); load(current,false); }
};
document.getElementById('btnVisual').onclick = ()=>{
  if(mode!=='visual'){ mode='visual'; localStorage.setItem('four.mode',mode); renderModeUI(); load(current,false); }
};

/* Load YouTube API */
(function(){
  const tag=document.createElement('script'); tag.src="https://www.youtube.com/iframe_api";
  const first=document.getElementsByTagName('script')[0]; first.parentNode.insertBefore(tag, first);
})();
</script>
</body>
</html>
